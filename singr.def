
BootStrap: docker
From: ubuntu:18.04

%apprun R
exec R --quiet --no-save "${@}"

%runscript
exec R --quiet --no-save "${@}"

%post
# Software versions
export R_VERSION=3.6.2

# Get dependencies
        apt-get update
        DEBIAN_FRONTEND=noninteractive apt-get install -yqq --no-install-recommends \
            locales \
            gnupg \
            build-essential

# Configure default locale
        echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
        locale-gen en_US.utf8
        /usr/sbin/update-locale LANG=en_US.UTF-8
        export LC_ALL=en_US.UTF-8
        export LANG=en_US.UTF-8

# Install R
        echo "deb http://cran.r-project.org/bin/linux/ubuntu bionic-cran35/" > /etc/apt/sources.list.d/r.list
        apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
        apt-get update
        DEBIAN_FRONTEND=noninteractive apt-get install -yqq --no-install-recommends \
            r-base=${R_VERSION}* \
            libcurl4-openssl-dev \
            libssl-dev \
            libxml2-dev \
            libcairo2-dev \
            libxt-dev

# Install geospatial system deps
       DEBIAN_FRONTEND=noninteractive apt-get install -yqq --no-install-recommends \
           libgdal-dev \
           gdal-bin \
           libgeos-dev \
           libgeos++-dev \

# Add a default CRAN mirror JIC
            echo "options(repos = c(CRAN = 'https://cran.rstudio.com/'), download.file.method = 'libcurl')" >> /usr/lib/R/etc/Rprofile.site

# install aws-cli
      DEBIAN_FRONTEND=noninteractive apt-get install -yqq --no-install-recommends python-pip3
      pip3 install awscli --upgrade

# Clean up
            rm -rf /var/lib/apt/lists/*

